<div class="container">
  <div class="row" *ngIf="createOpportunity || updateOpportunity">
    <div class="col-lg-12">
      <form [formGroup]="form">
        <div id="accordion">
          <div class="card">
            <div class="card-header" id="headingOne">
              <h5 class="mb-0">
                <button [ngClass]="{
                    'text-danger': isInvalid
                  }" class="btn btn-link" data-toggle="collapse" data-target="#collapseOpportunityInformation"
                  aria-expanded="true" aria-controls="collapseOpportunityInformation">
                  Opportunity Information
                </button>
              </h5>
            </div>

            <div id="collapseOpportunityInformation" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
              <div class="card-body">
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="inputOpportunityName">Opportunity Name*</label>
                    <input [ngClass]="{
                        'is-invalid': isInvalid && !form.controls.name.value
                      }" type="email" class="form-control" id="inputOpportunityName" formControlName="name" />
                  </div>
                  <div class="form-group col-md-6">
                    <label for="inputSalutation">Account Name</label>
                    <div class="input-group input-border mb-3">
                      <label *ngIf="lookUpAccount" for="inputSalutation" class="form-control" (click)="searchLookUp('Accounts'); this.modalService.open('searchAccount');">{{lookUpAccount.Name}}</label>
                      <label *ngIf="!lookUpAccount" for="inputSalutation" class="form-control" (click)="searchLookUp('Accounts'); this.modalService.open('searchAccount');"></label>
                      <div *ngIf="lookUpAccount" class="input-group-append">
                        <button title="Remove Account Name" (click)="deleteLookUp('accountId')" class="btn btn-outline-dark" type="button">
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-trash-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="form-row ">
                  <div class="form-group col-md-6">
                    <label for="inputType">Type</label>
                    <select formControlName="type" id="inputType" class="form-control">
                      <option value="" selected disabled hidden>Choose here</option>
                      <option *ngFor="let type of typeValues" value="{{ type }}" class="form-control">{{ type }}
                      </option>
                    </select>
                  </div>
                  <div class="form-group col-md-6">
                    <label for="inputLeadSource">Lead Source</label>
                    <select formControlName="leadSource" id="inputLeadSource" class="form-control">
                      <option value="" selected disabled hidden>Choose here</option>
                      <option *ngFor="let type of leadSourceValues" value="{{ type }}" class="form-control">{{ type }}
                      </option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="inputAmount">Amount</label>
                    <input [ngClass]="{
                      'is-invalid': form.controls.amount.errors
                    }" type="text" class="form-control" id="inputAmount" formControlName="amount" />
                  </div>
                  <div class="form-group col-md-6">
                    <label for="inputAmount">Expected Revenue</label>
                    <input [ngClass]="{
                      'is-invalid': form.controls.amount.errors
                    }" type="text" class="form-control" id="inputAmount" formControlName="revenue" />
                  </div>

                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="inputCloseDate">Close Date*</label>
                    <input [ngClass]="{
                        'is-invalid': isInvalid && !form.controls.closeDate.value
                      }" type="date" class="form-control" id="inputCloseDate" formControlName="closeDate" />
                  </div>
                  <div class="form-group col-md-6">
                    <label for="inputNextStep">Next Step</label>
                    <input type="text" class="form-control" id="inputNextStep" formControlName="nextStep" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="inputStage">Stage*</label>
                    <select [ngClass]="{
                        'is-invalid': isInvalid && !form.controls.stageName.value
                      }" formControlName="stageName" id="inputStage" class="form-control">
                      <option value="" selected disabled hidden>Choose here</option>
                      <option *ngFor="let type of stageValues" value="{{ type }}" class="form-control">{{ type }}
                      </option>
                    </select>
                  </div>

                  <div class="form-group col-md-6">
                    <label for="inputProbability">Probability (%)</label>
                    <input [ngClass]="{
                      'is-invalid': form.controls.probability.errors
                    }" type="text" class="form-control" id="inputProbability" formControlName="probability" />
                  </div>
                </div>
                <!-- <div class="form-row">
                  <div class="form-group col-md-12">
                    <label for="inputCampainId">Primary Campaign Source</label>
                    <div class="input-group input-border mb-3">
                      <label *ngIf="lookUpContact" for="inputSalutation" class="form-control" (click)="searchLookUp('Contacts'); this.modalService.open('searchContact');">{{lookUpContact.Name}}</label>
                      <label *ngIf="!lookUpContact" for="inputSalutation" class="form-control" (click)="searchLookUp('Contacts'); this.modalService.open('searchContact');"></label>

                      <div *ngIf="lookUpContact" class="input-group-append">
                        <button title="Remove Primary Campaign Source" (click)="deleteLookUp('campaignId')" class="btn btn-outline-dark" type="button">
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-trash-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </div>
                </div> -->
                <div class="form-group form-check">
                  <input formControlName="isPrivate" type="checkbox" class="form-check-input" id="inputPrivate" />
                  <label class="form-check-label" for="inputPrivate">Private</label>
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="card">
            <div class="card-header" id="headingThree">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse"
                  data-target="#collapseAdditionalInformation" aria-expanded="false"
                  aria-controls="collapseAdditionalInformation">
                  Additional Information
                </button>
              </h5>
            </div>
            <div id="collapseAdditionalInformation" class="collapse" aria-labelledby="headingThree"
              data-parent="#accordion">
              <div class="card-body">
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="inputOrderNumber">Order Number</label>
                    <input type="text" class="form-control" id="inputOrderNumber" formControlName="orderNumber__c" />
                  </div>
                  <div class="form-group col-md-4">
                    <label for="inputCurrentGenerator">Current Generator(s)</label>
                    <input type="text" class="form-control" id="inputCurrentGenerator"
                      formControlName="currentGenerators__c" />
                  </div>
                  <div class="form-group col-md-4">
                    <label for="inputTrackingNumber">Tracking Number</label>
                    <input type="text" class="form-control" id="inputTrackingNumber"
                      formControlName="trackingNumber__c" />
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="inputMainCompetitors">Main Competitor(s)</label>
                    <input type="text" class="form-control" id="inputMainCompetitors"
                      formControlName="mainCompetitors__c" />
                  </div>
                  <div class="form-group col-md-6">
                    <label for="inputDelivery">Delivery/Installation Status</label>
                    <select formControlName="deliveryInstallationStatus__c" id="inputDelivery" class="form-control">
                      <option value="" selected disabled hidden>Choose here</option>
                      <option *ngFor="let type of deliveryInstallationStatus__cValues" value="{{ type }}"
                        class="form-control">{{ type }}</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div> -->
          <div class="card">
            <div class="card-header" id="headingFour">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseDescription"
                  aria-expanded="false" aria-controls="collapseDescription">
                  Description Information
                </button>
              </h5>
            </div>
            <div id="collapseDescription" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">
              <div class="card-body">
                <div class="form-group">
                  <label for="description">Description:</label>
                  <textarea formControlName="description" class="form-control" rows="5" id="description"></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="form-row text-center mt-2">
          <div class="col-md-6">
            <button *ngIf="updateOpportunity" (click)="onSubmit(true)"
              class="btn btn-outline-dark action-button mt-1 mb-1">Submit</button>
            <button *ngIf="createOpportunity" (click)="onSubmit(false)"
              class="btn btn-outline-dark action-button mt-1 mb-1">Submit</button>
          </div>
          <div class="col-md-6">
            <button *ngIf="createOpportunity" type="button" (click)="cancelAction(true)"
              class="btn btn-outline-dark action-button mt-1 mb-1">Cancel</button>
            <button *ngIf="updateOpportunity" type="button" (click)="cancelAction()"
              class="btn btn-outline-dark action-button mt-1 mb-1">Cancel</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- VIEW -->
  <div *ngIf="viewOpportunity">
    <div class="row mt-3 mb-3">
      <div class="col-6 text-center">
        <button (click)="cancelAction(true)" type="button" class="btn btn-outline-dark">Go back</button>
      </div>
      <div class="col-6 text-center">
        <button type="button" (click)="createForm(opportunity)" class="btn btn-outline-dark">
          Update
        </button>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">

        <div id="accordion">
          <div class="card">
            <div class="card-header" id="headingOne">
              <h5 class="mb-0">
                <button [ngClass]="{
                    'text-danger': isInvalid
                  }" class="btn btn-link" data-toggle="collapse" data-target="#collapseOpportunityInformation"
                  aria-expanded="true" aria-controls="collapseOpportunityInformation">
                  Opportunity Information
                </button>
              </h5>
            </div>

            <div id="collapseOpportunityInformation" class="collapse show" aria-labelledby="headingOne"
              data-parent="#accordion">
              <div class="card-body row">
                <div class="col-md-6">
                  <table class="rwd_auto">
                    <thead>
                      <tr></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">Opportunity Name</th>
                        <td>{{ opportunity.Name }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Private</th>
                        <td>{{ opportunity.IsPrivate }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Account Name</th>
                        <td *ngIf="lookUpAccount"> {{lookUpAccount.Name}} </td>
                        <td *ngIf="!lookUpAccount"></td>
                      </tr>
                      <tr>
                        <th scope="row">Type</th>
                        <td>{{ opportunity.Type }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Lead Source</th>
                        <td>{{ opportunity.LeadSource }}</td>
                      </tr>
                      <tr>
                      <!-- <tr>
                        <th scope="row">Primary Campaign Source</th>
                        <td *ngIf="lookUpContact"> {{lookUpContact.Name}} </td>
                        <td *ngIf="!lookUpContact"></td>
                      </tr> -->
                    </tbody>
                  </table>
                </div>
                <div class="col-md-6">
                  <table class="rwd_auto">
                    <thead>
                      <tr></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">Expected Revenue</th>
                        <td>{{ opportunity.ExpectedRevenue | currency : 'USD' }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Amount</th>
                        <td>{{ opportunity.Amount | currency : 'USD' }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Close Date</th>
                        <td>{{ opportunity.CloseDate | date : 'MM/dd/yyyy' : 'UTC/GMT'}}</td>
                      </tr>
                      <tr>
                        <th scope="row">Next Step</th>
                        <td>{{ opportunity.NextStep }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Stage</th>
                        <td>{{ opportunity.StageName }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Probability (%)</th>
                        <td>{{ opportunity.Probability }}%</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="card">
            <div class="card-header" id="headingThree">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse"
                  data-target="#collapseAdditionalInformation" aria-expanded="true"
                  aria-controls="collapseAdditionalInformation">
                  Additional Information
                </button>
              </h5>
            </div>
            <div id="collapseAdditionalInformation" class="collapse show" aria-labelledby="headingThree"
              data-parent="#accordion">
              <div class="card-body row">
                <div class="col-md-6">
                  <table class="rwd_auto">
                    <thead>
                      <tr></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">Order Number</th>
                        <td>{{ opportunity.OrderNumber__c }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Current Generator(s)</th>
                        <td>{{ opportunity.CurrentGenerators__c }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Tracking Number</th>
                        <td>{{ opportunity.TrackingNumber__c }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-md-6">
                  <table class="rwd_auto">
                    <thead>
                      <tr></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">Main Competitor(s)</th>
                        <td>{{ opportunity.MainCompetitors__c }}</td>
                      </tr>
                      <tr>
                        <th scope="row">Delivery/ Installation Status</th>
                        <td>{{ opportunity.DeliveryInstallationStatus__c }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div> -->
          <div class="card">
            <div class="card-header" id="headingFour">
              <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseDescription"
                  aria-expanded="true" aria-controls="collapseDescription">
                  Description Information
                </button>
              </h5>
            </div>
            <div id="collapseDescription" class="collapse show" aria-labelledby="headingFour" data-parent="#accordion">
              <div class="card-body">
                <div class="col-md-12">
                  <table class="rwd_auto">
                    <thead>
                      <tr></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">Description</th>
                        <td>{{ opportunity.Description }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-modal id="searchAccount" (Close)="onCloseModal($event)" (Open)="OnOpenModal($event)">
  <div>
    <h2 class="text-center">Search Account Name</h2>
  </div>
  <div class="row">
    <div class="col-12">
      <div class="input-group input-border mb-3">
        <input placeholder="Search" [(ngModel)]="searchText" type="text" class="form-control">
        <div *ngIf="searchText" class="input-group-append">
          <button title="Delete selected Account Name" (click)="clearSearch('Accounts')" class="btn btn-outline-dark" type="button">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-x-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
              <path fill-rule="evenodd" d="M11.854 4.146a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708-.708l7-7a.5.5 0 0 1 .708 0z"/>
              <path fill-rule="evenodd" d="M4.146 4.146a.5.5 0 0 0 0 .708l7 7a.5.5 0 0 0 .708-.708l-7-7a.5.5 0 0 0-.708 0z"/>
            </svg>
          </button>
        </div>
        <div class="input-group-append">
          <button (click)="searchLookUp('Accounts');" class="btn btn-outline-dark"type="button">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
              <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
            </svg>
          </button>
        </div>
      </div>
      <div *ngIf="specificSearch" class="mb-3">
        <p class="text-center">Many matches were found with your search, please be more specific.</p>
      </div>
      <div *ngIf="LookUpListings" class="list-group" id="list-tab" role="tablist">
        <a
          *ngFor="let lookUp of LookUpListings"
          class="list-group-item list-group-item-action"
          data-toggle="list"
          (click)="LookUpSelected(lookUp, 'searchAccount')">{{lookUp.Name}}</a>
      </div>

      <div *ngIf="LookUpListings404" class="card text-center mt-3">
        <div class="card-body">
          <h5 class="card-title">No Results found!</h5>
          <p class="card-text">
            Sorry, but nothing matched your search terms. Please try again with some different keywords.
          </p>
        </div>
      </div>

    </div>
  </div>
</app-modal>

<app-modal #searchModal id="searchContact" (Close)="onCloseModal($event)" (Open) ="OnOpenModal($event)">
  <div>
    <h2 class="text-center">Search Contact Name</h2>
  </div>
  <div class="row">
    <div class="col-12">

      <div class="input-group input-border mb-3">
        <input placeholder="Search" [(ngModel)]="searchText" type="text" class="form-control">
        <div *ngIf="searchText" class="input-group-append">
          <button title="Clear search" (click)="clearSearch('Contacts')" class="btn btn-outline-dark" type="button">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-x-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
              <path fill-rule="evenodd" d="M11.854 4.146a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708-.708l7-7a.5.5 0 0 1 .708 0z"/>
              <path fill-rule="evenodd" d="M4.146 4.146a.5.5 0 0 0 0 .708l7 7a.5.5 0 0 0 .708-.708l-7-7a.5.5 0 0 0-.708 0z"/>
            </svg>
          </button>
        </div>
        <div class="input-group-append">
          <button (click)="searchLookUp('Contacts');" class="btn btn-outline-dark"type="button">
            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
              <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
            </svg>
          </button>
        </div>
      </div>
      <div *ngIf="specificSearch" class="mb-3">
        <p class="text-center">Many matches were found with your search, please be more specific.</p>
      </div>
      <div *ngIf="LookUpListings" class="list-group" id="list-tab" role="tablist">
        <a
          *ngFor="let lookUp of LookUpListings"
          class="list-group-item list-group-item-action"
          data-toggle="list"
          (click)="LookUpSelected(lookUp, 'searchContact')">{{lookUp.FirstName}} {{lookUp.LasName}}</a>
      </div>

      <div *ngIf="LookUpListings404" class="card text-center mt-3">
        <div class="card-body">
          <h5 class="card-title">No Results found!</h5>
          <p class="card-text">
            Sorry, but nothing matched your search terms. Please try again with some different keywords.
          </p>
        </div>
      </div>

    </div>
  </div>
</app-modal>
